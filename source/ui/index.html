<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Serverless Image Handler</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <!-- Custom CSS -->
    <link href="css/thumbnail-gallery.css" rel="stylesheet">
</head>

<body>

    <!-- Navigation -->
    <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Serverless Image Handler Demo</a>
            </div>
        </div>
        <!-- /.container -->
    </nav>

    <!-- Page Content -->
    <div class="container-fluid">

        <div class="row">
            <div class="col-lg-3" style="overflow-y: scroll; height: 770px;">
                <div class="col-lg-12">
                    <h1 class="page-header">Gallery</h1>
                </div>

                <div class="col-lg-12">
                    <a class="thumbnail" href="#">
                        <img class="img-responsive" src="%%S3URL%%img/aws-logo.png" alt="">
                    </a><br />
                    <a class="thumbnail" href="#">
                        <img class="img-responsive" src="%%S3URL%%img/balloon.jpg" alt="">
                    </a><br />
                    <a class="thumbnail" href="#">
                        <img class="img-responsive" src="%%S3URL%%img/planet.jpg" alt="">
                    </a><br />
                    <a class="thumbnail" href="#">
                        <img class="img-responsive" src="%%S3URL%%img/face.jpg" alt="">
                    </a><br />
                    <a class="thumbnail" href="#">
                        <img class="img-responsive" src="%%S3URL%%img/face2.jpg" alt="">
                    </a>
                </div>
            </div>
            <div class="col-lg-4">
              <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Parameters</h1>
                </div>
              </div>
              <form>
              <div class="row">
                <div class="form-group col-lg-12">
                    <label for="image-url">Image Url:</label>
                    <input class="form-control" type="text" name="image-url" id="image-url" placeholder="Select one of the images in the left panel">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-lg-4">
                    <label for="width">Width:</label>
                    <input class="form-control" type="text" name="width" id="width" value="300">
                </div>
                <div class="form-group col-lg-4">
                    <label for="height">Height:</label>
                    <input class="form-control" type="text" name="height" id="height" value="300">
                </div>
                <div class="form-group col-lg-4">
                    <input class="checkbox-inline" type="checkbox" id="fill_checkbox">
                    <label for="fill">Fill:</label>
                    <input class="form-control" type="text" name="fill" id="fill" value="FF9900">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-lg-4">
                    <input type="checkbox" id="brightness_checkbox">
                    <label for="brightness">Brightness:</label>
                    <input class="form-control" type="text" name="brightness" id="brightness" placeholder="-100 to 100">
                </div>
                <div class="form-group col-lg-4">
                    <input type="checkbox" id="contrast_checkbox">
                    <label for="contrast">Contrast:</label>
                    <input class="form-control" type="text" name="contrast" id="contrast" placeholder="-100 to 100">
                </div>
                <div class="form-group col-lg-4">
                    <input class="checkbox-inline" type="checkbox" id="bgcolor_checkbox">
                    <label for="bgcolor">BG Color:</label>
                    <input class="form-control" type="text" name="bgcolor" id="bgcolor" value="FF9900">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-lg-4">
                    <input type="checkbox" id="quality_checkbox">
                    <label for"quality">Quality:</label>
                    <input class="form-control" type="text" name="quality" id="quality" placeholder="0 to 100">
                </div>
                <div class="form-group col-lg-4">
                    <input type="checkbox" id="noise_checkbox">
                    <label for"noise">Noise:</label>
                    <input class="form-control" type="text" name="noise" id="noise" placeholder="0 to 100">
                </div>
                <div class="form-group col-lg-4">
                    <input class="checkbox-inline" type="checkbox" id="blur_checkbox">
                    <label for="blur">Blur:</label>
                    <input class="form-control" type="text" name="blur" id="blur" placeholder="1-150">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-lg-4">
                    <input type="checkbox" id="sharpen_checkbox">
                    <label for="sharpen">Sharpen:</label>
                    <input class="form-control" type="text" name="sharpen" id="sharpen" value="2.0,1.0,true">
                </div>
                <div class="form-group col-lg-4">
                    <input type="checkbox" id="rotate_checkbox">
                    <label for"rotate">Rotate:</label>
                    <select class="form-control" id="rotate">
                      <option value="0">0째</option>
                      <option value="90">90째</option>
                      <option value="180">180째</option>
                      <option value="270">270째</option>
                    </select>
                </div>
                <div class="form-group col-lg-4">
                    <input class="checkbox-inline" type="checkbox" id="format_checkbox">
                    <label for="blur">ImgType:</label>
                    <select class="form-control" id="format">
                      <option value="jpeg">jpeg</option>
                      <option value="png">png</option>
                      <option value="webp">webp</option>
                      <option value="gif">gif</option>
                    </select>
                </div>
              </div>
              <div class="row">
                <div class="form-group col-lg-8">
                    <input class="checkbox-inline" type="checkbox" id="convolution_checkbox">
                    <label for="convolution">Convolution:</label>
                    <input class="form-control" type="text" name="convolution" id="convolution" value="-1;-1;-1;-1;8;-1;-1;-1;-1,3,false">
                </div>
                <div class="form-group col-lg-4">
                    <input type="checkbox" id="maxbytes_checkbox">
                    <label for="maxbytes">Max Bytes:</label>
                    <input class="form-control" type="text" name="maxbytes" id="maxbytes" placeholder="40000">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-lg-6">
                    <input type="checkbox" id="roundcorner_checkbox">
                    <label for"roundcorner">Round Corner (a|b,r,g,b):</label>
                    <input class="form-control" type="text" name="roundcorner" id="roundcorner" value="20,255,255,255">
                </div>
                <div class="form-group col-lg-6">
                    <input type="checkbox" id="rgb_checkbox">
                    <label for"rgb">RGB:</label>
                    <input class="form-control" type="text" name="rgb" id="rgb" value="20,-20,20">
                </div>
              </div>
              <div class="row">
                <div class="form-group col-lg-4">
                    <input class="checkbox-inline" type="checkbox" id="fit_in_checkbox" checked>
                    <label for="fit_in">Fit In:</label>
                    <select class="form-control" id="fit_in">
                      <option value="fit-in">fit-in</option>
                      <option value="full-fit-in">full</option>
                      <option value="adaptive-fit-in">adaptive</option>
                    </select>
                </div>
                <div class="col-lg-4">
                    <input type="checkbox" id="black_white">
                    <label for"black_white">Black &amp; White</label>
                    <br />
                    <input type="checkbox" id="equalize">
                    <label for="equalize">Equalize</label>
                    <br />
                    <input type="checkbox" id="strip_icc">
                    <label for="strip_icc">Strip ICC</label>
                    <br />
                    <input type="checkbox" id="smart_crop">
                    <label for="smart_crop">Smart Crop</label>
                </div>
                <div class="form-group col-lg-4">
                    <a href="#" class="btn btn-primary btn-lg active" role="button" aria-pressed="true" onClick="justDoIt()">Just do it!</a>
                </div>
              </div>
              </form>
            </div>
            <div class="col-lg-5">
              <div class="row">
                <div class="col-lg-12">
                    <h1 class="page-header">Output</h1>
                    <label for="image-url">Output Url:</label>
                    <input class="form-control" type="text" name="new-url" id="new-url" placeholder="New manipulated image URL">
                    <br />
                    <div id="output_links" style="font-size: 20px"></div>
                </div>
              </div>
            </div>
        </div>

    </div>
    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
</body>

<script>
    createUrl = {
        baseUrl: "https://%%CloudFrontDomainName%%",

        resize: function(imageOriginalUrl, resizeW, resizeH, fit_in, smart_crop, filter) {

            imageUrlParts = imageOriginalUrl.split('?')[0].split('/');

            imageName = imageUrlParts[4] + '/' + imageUrlParts[5] + '/' + imageUrlParts[6];
            url = this.baseUrl + fit_in + '/' + resizeW + 'x' + resizeH + smart_crop + filter + '/' + imageName;

            return url;
        }
    };
    function justDoIt() {
        w = document.getElementById('width').value;
        h = document.getElementById('height').value;
        b = document.getElementById('brightness').value;
        c = document.getElementById('contrast').value;

        filter = '';
        fit_in = '';
        smart_crop = '';
        if ($('#brightness_checkbox').is(':checked') && b !== "" && b !=="0"){
            filter += ':brightness(' + b + ')';
        }
        if ($('#contrast_checkbox').is(':checked') && c !== "" && c !== "0"){
            filter += ':contrast(' + c + ')';
        }
        if ($('#blur_checkbox').is(':checked') && $('#blur').val() > 0) {
            filter += ':blur(' + $('#blur').val() + ')';
        }
        if ($('#sharpen_checkbox').is(':checked') && $('#sharpen').val() !== '') {
            filter += ':sharpen(' + $('#sharpen').val() + ')';
        }
        if ($('#fill_checkbox').is(':checked') && $('#fill').val() !== '') {
            filter += ':fill(' + $('#fill').val() + ')';
        }
        if ($('#bgcolor_checkbox').is(':checked') && $('#bgcolor').val() !== '') {
            filter += ':background_color(' + $('#bgcolor').val() + ')';
        }
        if ($('#format_checkbox').is(':checked')) {
            filter += ':format(' + $('#format').val() + ')';
        }
        if ($('#convolution_checkbox').is(':checked') && $('#convolution').val() !== '') {
            filter += ':convolution(' + $('#convolution').val() + ')';
        }
        if ($('#rotate_checkbox').is(':checked') && $('#rotate').val() > 0) {
            filter += ':rotate(' + $('#rotate').val() + ')';
        }
        if ($('#maxbytes_checkbox').is(':checked') && $('#maxbytes').val() > 0) {
            filter += ':max_bytes(' + $('#maxbytes').val() + ')';
        }
        if ($('#quality_checkbox').is(':checked') && $('#quality').val() > 0) {
            filter += ':quality(' + $('#quality').val() + ')';
        }
        if ($('#noise_checkbox').is(':checked') && $('#noise').val() > 0) {
            filter += ':noise(' + $('#noise').val() + ')';
        }
        if ($('#rgb_checkbox').is(':checked') && $('#rgb').val() !== '') {
            filter += ':rgb(' + $('#rgb').val() + ')';
        }
        if ($('#roundcorner_checkbox').is(':checked') && $('#roundcorner').val() !== '') {
            filter += ':round_corner(' + $('#roundcorner').val() + ')';
        }
        if ($('#black_white').is(':checked')) {
            filter += ':grayscale()';
        }
        if ($('#equalize').is(':checked')) {
            filter += ':equalize()';
        }
        if ($('#strip_icc').is(':checked')) {
            filter += ':strip_icc()';
        }
        if (filter) {
            filter = '/filters' + filter;
        }
        if ($('#fit_in_checkbox').is(':checked')) {
            fit_in = '/' + $('#fit_in').val();
        }
        if ($('#smart_crop').is(':checked')) {
            smart_crop = '/smart';
        }
        url = createUrl.resize(document.getElementById('image-url').value, w, h, fit_in, smart_crop, filter);
        img_link = '<a target="_blank" href="' + url + '"><img style="border:2px solid" src="'+url+'"></a>';
        ph = $('#output_links');
        ph.html('Loading...');
        var newImg = new Image();
        newImg.onload = function() { ph.html(img_link); }
        newImg.src = url;
        console.log(ph, img_link);
        $("#new-url").val(url);
     }

     $(document).ready( function() {
       $(".img-responsive").click(function(){
           $("#image-url").val($(this).attr('src'));
           justDoIt();
       });
       $('#black_white').change(function () { justDoIt(); });
       $('#equalize').change(function () { justDoIt(); });
       $('#strip_icc').change(function () { justDoIt(); });
       $('#fit_in_checkbox').change(function () { justDoIt(); });
       $('#fit_in').change(function () { justDoIt(); });
       $('#smart_crop').change(function () { justDoIt(); });
       $('#width').change(function () { justDoIt(); });
       $('#height').change(function () { justDoIt(); });
       $('#brightness').change(function () { justDoIt(); });
       $('#brightness_checkbox').change(function () { justDoIt(); });
       $('#contrast').change(function () { justDoIt(); });
       $('#contrast_checkbox').change(function () { justDoIt(); });
       $('#fill_checkbox').change(function () { justDoIt(); });
       $('#fill').change(function () { justDoIt(); });
       $('#bgcolor_checkbox').change(function () { justDoIt(); });
       $('#bgcolor').change(function () { justDoIt(); });
       $('#format_checkbox').change(function () { justDoIt(); });
       $('#format').change(function () { justDoIt(); });
       $('#convolution_checkbox').change(function () { justDoIt(); });
       $('#convolution').change(function () { justDoIt(); });
       $('#rotate_checkbox').change(function () { justDoIt(); });
       $('#rotate').change(function () { justDoIt(); });
       $('#maxbytes_checkbox').change(function () { justDoIt(); });
       $('#maxbytes').change(function () { justDoIt(); });
       $('#blur_checkbox').change(function () { justDoIt(); });
       $('#blur').change(function () { justDoIt(); });
       $('#sharpen_checkbox').change(function () { justDoIt(); });
       $('#sharpen').change(function () { justDoIt(); });
       $('#quality_checkbox').change(function () { justDoIt(); });
       $('#quality').change(function () { justDoIt(); });
       $('#noise_checkbox').change(function () { justDoIt(); });
       $('#noise').change(function () { justDoIt(); });
       $('#rgb_checkbox').change(function () { justDoIt(); });
       $('#rgb').change(function () { justDoIt(); });
       $('#roundcorner_checkbox').change(function () { justDoIt(); });
       $('#roundcorner').change(function () { justDoIt(); });
       if ($('#image-url').val() !== '') { justDoIt();}
     });

</script>

</html>
